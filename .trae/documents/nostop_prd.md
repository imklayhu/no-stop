# NoStop (不停车) - 产品需求文档 (MVP)

## 1. 产品概述

**产品名称**：NoStop (不停车)
**核心Slogan**：为公路车而生的连续路线
**产品定位**：专为城市公路车骑行者设计的智能路书生成工具，解决绕圈训练中频繁停车、路线不连贯的痛点。
**MVP核心目标**：提供**可解释、可重复、高质量**的城市绕圈训练路线，确保**红绿灯少、无掉头弯、节奏流畅**。

### 1.1 目标用户
*   **核心用户**：城市公路车骑行爱好者，注重训练效率，厌恶频繁启停。
*   **场景**：城市周边的绕圈训练（Loop Training）、夜骑训练、FTP/有氧耐力训练。

### 1.2 MVP 范围界定 (不做清单)
*   ❌ **不做**：复杂的社交功能、Garmin/Strava 深度双向同步（仅支持GPX导出）、复杂爬坡建模、实时天气/风向感知、AI 自由聊天。
*   ✅ **只做**：极简输入 -> 智能生成 -> 评分筛选 -> 导出路书。

## 2. 核心功能模块

### 2.1 首页/生成页 (极简输入)
用户只需提供最核心的训练约束，减少决策成本。
*   **自动定位**：进入首页自动获取当前经纬度作为**起点**。用户可点击起点信息跳转至“位置选择页”进行修改。无需输入终点（默认为闭环）。
*   **目标距离**：提供快捷选项 `10km` / `20km` / `30km` / `40km`，也支持自定义。
*   **训练类型**：MVP 仅支持 `城市绕圈 (Urban Loop)`。点击该类型仅为选中状态，不触发生成。
    *   **定义**：绕圈路线必须是**闭环**的，即起点与终点必须回到同一位置（或极近范围内）。路线可以是折返式（A -> B -> A）或环线式（A -> B -> C -> A）。
*   **生成触发**：用户配置完毕后，点击底部的“生成训练路书”按钮，触发后台 AI + 算法流程。

### 2.2 路线结果页 (智能呈现)
展示经过算法筛选后的最佳 **3条候选路线**，用户可左右切换查看。
*   **地图可视化**：在百度地图上绘制路线，**高亮**标记红绿灯位置、关键转弯点。
*   **核心指标卡片**：
    *   🚥 **红绿灯数**：融合百度地图数据（指令解析）与**汽车导航 API**（辅助校验），提供更准确的计数。
    *   🚦 **实时路况**：调用汽车导航 API 获取路段拥堵状态，展示“畅通/缓行/拥堵”标签，并参与评分。
    *   ↩️ **掉头弯数**：MVP 目标为 0。
    *   📏 **连续路段**：展示最长连续无中断骑行距离（如 "5km 连续直路"）。
    *   💯 **综合评分**：基于上述指标（含路况权重）的算法打分（0-100）。
*   **AI 路书点评**：LLM 生成的自然语言描述，例如：“这条路线全长 30.5km，避开了晚高峰拥堵的世纪大道，滨江段有 12km 无红绿灯直路，适合做甜区功率训练。”

### 2.3 导出页面
*   **GPX 导出**：生成标准的 `.gpx` 文件，支持导入佳明 (Garmin)、迈金等码表或 Strava。
*   **路书分享** (P1)：生成一张包含路线图和核心数据的图片用于社交分享。

## 3. 核心业务流程

```mermaid
graph TD
    A[用户打开App] --> B[自动定位 + 输入距离(30km)]
    B --> C[点击生成]
    C --> D{后端处理}
    D --> D1[LLM 意图解析 (可选)]
    D1 --> D2[MCP Server + 百度地图 API 调用]
    D2 --> D3[生成 N 条候选闭环路线]
    D3 --> D4[评分引擎 (红绿灯/掉头/连续性)]
    D4 --> D5[筛选 Top 3 路线]
    D5 --> D6[LLM 生成路书点评]
    D6 --> E[前端展示结果]
    E --> F[查看详情 & 导出 GPX]
```

## 4. 路线评分算法 (MVP版)

核心不是大模型直接生成路线，而是**大模型辅助 + 确定性算法评分**。

**评分公式示例**：
```text
Score = 100 
      - (红绿灯数量 * 5) 
      - (掉头弯数量 * 10) 
      - (急转弯数量 * 3) 
      + (连续路段长度系数 * 权重)
```
*   **一票否决**：如果存在无法通行的路段或禁行区域，直接剔除。

## 5. 用户界面设计 (UI)

*   **风格**：硬核、科技、运动。
*   **主色调**：
    *   **黑/深灰** (#0F172A)：背景，沉浸感，省电。
    *   **活力橙** (#F59E0B)：强调色，代表动能、警示、路线轨迹。
    *   **荧光绿** (#10B981)：代表畅通、各项指标优秀。
*   **交互**：
    *   大按钮，方便骑行手套操作。
    *   地图占比 > 60%，强调路线本身。

## 6. 成功标准 (Success Metrics)

为了验证 MVP 是否成功，我们关注以下指标：
*   **体验流畅度**：用户在生成的路线上骑行时，很少因非必要的红绿灯或路况被迫停车。
*   **复用率 (Retention)**：用户愿意重复使用同一条路线，或再次使用 App 生成新路线。
*   **性能达标**：路线生成全流程耗时控制在 **15秒** 以内（含 LLM 调用与算法计算）。
*   **用户口碑**：用户反馈“这条路我自己还真找不到”或“比我自己瞎骑强多了”。

## 7. 后续规划 (Roadmap)
*   **v1.1**：引入补给点 (POI) 搜索，标注沿途便利店/厕所。
*   **v1.2**：夜骑模式，引入路灯密度数据作为评分因子。
*   **v2.0**：爬坡训练模式，引入高程数据分析。
