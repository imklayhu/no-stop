# 用户故事 - NoStop: 智能路线规划器 (MVP)

## Epic 1: 路线生成引擎
**优先级**: 关键 (Critical)

### Story 1.1: 生成绕圈路线 (基础)
**作为一个** 计划进行训练的资深骑行者
**我想要** 输入我的出发位置、总距离（例如 30km）和偏好的绕圈大小
**以便于** 我能获得一条连接我家和合适训练圈的可骑行路线，而无需手动绘制。
**但是** 我不希望绕圈地点太远，导致我骑行过多的垃圾里程（无效路程）。

**验收标准 (Gherkin):**
```gherkin
功能: 基础路线生成

  场景: 用户请求一条 30km 的路线
    假如 我在“生成路线”页面
    并且 我的位置被检测为“世纪公园”
    当 我输入“30km”作为目标距离
    并且 我点击“生成”
    那么 系统应该返回路线列表
    并且 每条路线的“总距离”应在 28km 到 32km 之间
    并且 路线结构应为“起点 -> 入圈路段 -> 绕圈 -> 出圈路段 -> 起点”
```

### Story 1.2: 夜间模式过滤
**作为一个** 在工作日晚上训练的骑行者
**我想要** 在生成前选择“夜间模式”
**以便于** 算法过滤掉没有路灯的道路，并优先选择照明良好的大道。
**但是** 如果不存在完美照明的路线，请警告我而不是什么都不返回。

**验收标准 (Gherkin):**
```gherkin
功能: 夜间模式逻辑

  场景: 生成夜间路线
    假如 我选择了“夜间模式”
    当 我请求一条路线
    那么 系统应该优先选择“路灯密度” > 阈值 的道路
    并且 系统应该惩罚“卡车流量” > 高 的道路
    并且 生成路线的“安全评分”应反映照明条件
```

## Epic 2: 虚拟探路 (路线验证)

### Story 2.1: 查看路线详情 (探路报告)
**作为一个** 正在审查候选路线的用户
**我想要** 看到一份“虚拟探路报告”，包含“照明良好”、“宽敞非机动车道”、“低流量”等标签
**以便于** 我无需亲自前往即可信任路线质量。
**但是** 数据必须准确，否则我会失去信任。

**验收标准 (Gherkin):**
```gherkin
功能: 路线探路报告

  场景: 查看路线详情
    假如 我看到 3 条候选路线的列表
    当 我点击“路线 A”
    那么 我应该看到地图覆盖层
    并且 我应该看到指示“道路类型”的标签 (例如: 非机动车道占比: 80%)
    并且 我应该看到当前时间的“交通预测”
```

## Epic 3: 导出与集成

### Story 3.1: 导出为 GPX
**作为一个** 选择了完美路线的用户
**我想要** 一键下载标准的 `.gpx` 文件
**以便于** 我可以将其发送到我的 Garmin/Wahoo 码表进行逐向导航。

**验收标准 (Gherkin):**
```gherkin
功能: GPX 导出

  场景: 下载路线
    假如 我选择了“路线 B”
    当 我点击“下载 GPX”
    那么 一个名为 "NoStop_{日期}_{距离}.gpx" 的文件应该被下载
    并且 该文件应为有效的 XML 格式
    并且 该文件应包含整次骑行的轨迹点 (trkpt)
```

## Epic 4: 技术基础

### Story 4.1: 地图数据集成
**作为一个** 开发者
**我想要** 集成一个支持“非机动车道”和“道路类型”属性的地图提供商（例如 Mapbox/百度）
**以便于** 生成引擎拥有评分所需的原始数据。

**验收标准 (Gherkin):**
```gherkin
功能: 地图数据就绪

  场景: 获取道路属性
    假如 后端服务正在运行
    当 我查询特定路段的坐标
    那么 API 应该返回 "is_bike_lane" (是否有非机动车道) 或等效元数据
    并且 响应时间应低于 200ms
```
