# 产品需求文档 (PRD) - NoStop: 智能路线规划器
**版本**: 3.0 (草稿)
**日期**: 2026-01-30
**状态**: 提案

## 1. 简介

### 1.1 目的
本文档旨在定义 **NoStop (路线规划版)** 的需求。本次产品迭代从实时训练伴侣转向**专业的路线规划工具**。它通过使用 AI 和地图数据生成高质量的绕圈训练路线（可导出为 GPX 文件供码表使用），解决了“手动规划路线”和“实地探路”的问题。

### 1.2 范围
**NoStop** 是一个 Web/移动端工具，允许用户：
1.  **生成**: 基于位置、距离和时间段（夜间/白天）创建绕圈路线。
2.  **验证**: 查看“虚拟探路报告”，高亮显示道路状况（照明、交通预测）。
3.  **导出**: 下载标准的 `.gpx` 文件，传输至 Garmin/Wahoo/Bryton 等设备。

**非范围 (Out of Scope)**:
*   实时逐向导航（由码表处理）。
*   骑行中数据追踪（速度、踏频、心率）。
*   计圈或训练计划执行。

### 1.3 定义
*   **虚拟探路 (Virtual Scouting)**: 利用算法数据（卫星图像、POI 密度、街景分析、历史交通）在无需亲临现场的情况下评估道路适宜性的过程。
*   **GPX (GPS Exchange Format)**: 用于共享路线数据的标准文件格式。
*   **绕圈 (Loop)**: 闭环路线。

## 2. 总体描述

### 2.1 产品视角
NoStop 作为一个骑行前的规划工具。它位于骑行活动的上游。
流程: **NoStop (规划 & 导出)** -> **码表 (导入 & 导航)** -> **用户 (骑行)**。

### 2.2 用户特征
*   **目标用户**: 资深骑行者（业余到专业）。
*   **行为**: 拥有专用的 GPS 码表（Garmin Edge, Wahoo Elemnt）。他们非常关注“流畅度”（不停车）和安全性。
*   **痛点**: “我想今晚骑个 40km 的绕圈，但我不知道哪里安全，而且我不想花 30 分钟在 Strava 上画线。”

### 2.3 产品功能
1.  **智能路线生成**:
    *   **输入**: 起点、总距离（如 30km）、偏好绕圈大小（如 ~3km/圈）、场景（夜间/白天）。
    *   **逻辑**: 寻找附近符合“安全”和“流畅”标准的闭环。连接起点到绕圈（通勤路段）。
2.  **路线预览与选择**:
    *   展示前 3 名候选路线。
    *   显示“适宜性标签”: 如“照明充足”、“宽敞非机动车道”、“低流量”。
3.  **一键导出**:
    *   生成 `.gpx` 文件。
    *   (可选) 如果 API 可用，直接分享至第三方应用。

### 2.4 约束
*   **地图数据**: 依赖准确的基础地图数据（百度/Mapbox）获取道路属性。
*   **文件兼容性**: GPX 输出必须兼容主流硬件品牌。

## 3. 具体需求

### 3.1 功能需求

#### 3.1.1 路线生成引擎
*   **FR-1.1**: 系统应接受用户位置（自动检测或手动打点）。
*   **FR-1.2**: 系统应接受“目标距离”（如 30km）。
*   **FR-1.3**: 系统应接受“场景模式”:
    *   **夜间模式**: 惩罚无路灯道路，惩罚重型卡车路线，要求有非机动车道。
    *   **日间模式**: 标准安全评分，优先考虑风景或低交通密度。
*   **FR-1.4**: 系统应生成“通勤 + 绕圈”结构。
    *   路线 = 家 -> 绕圈起点 -> (绕圈 x N) -> 家。
    *   *注*: GPX 通常包含一圈的完整几何形状或完整轨迹。对于 MVP，我们生成完整轨迹（如 家 -> A -> B -> C -> A -> 家）。或者如果用户开车去，则仅生成绕圈本身。*决定: 生成完整的“可骑行”轨迹。*

#### 3.1.2 虚拟探路报告 (路线详情)
*   **FR-2.1**: 对于每条生成的路线，显示“探路报告”:
    *   **道路构成**: % 非机动车道, % 混合道路。
    *   **交通预估**: 基于时间段的“低”、“中”、“高”。
    *   **照明评分** (仅限夜间模式): “照明良好”、“昏暗”、“未知”。
    *   **路面质量**: (如果数据可用) “铺装”、“粗糙”。
*   **FR-2.2**: 在地图上显示关键“航点”（如急转弯警告、施工区域）。

#### 3.1.3 导出与集成
*   **FR-3.1**: 提供“下载 GPX”按钮。
*   **FR-3.2**: 文件命名约定: `NoStop_{日期}_{距离}km_{地点名称}.gpx`。
*   **FR-3.3**: 确保 GPX 包含海拔数据（如果可用），以便码表显示爬坡剖面。

### 3.2 用户界面需求
*   **平台**: 移动 Web / 桌面 Web (响应式)。
*   **地图交互**: 具有“卫星”图层选项的高保真地图，供人工验证。
*   **简洁性**: “生成” -> “选择” -> “下载”。MVP 无需登录（可选）。

### 3.3 性能需求
*   **生成速度**: < 10 秒找到候选绕圈。
*   **文件生成**: 即时 (< 1s)。

## 4. 验证策略
*   **用户验收测试 (UAT)**: 用户导出路线，放入 Garmin，并进行骑行。
    *   *成功*: 路线沿途安全，Garmin 上的逐向导航工作正常，且绕圈实际上是“可骑行”的（无锁住的门，无楼梯）。
*   **数据验证**: 随机抽样检查生成的路线与街景，确认“非机动车道”标签准确。

## 5. 路线图 (Roadmap)
*   **v1.0 (MVP)**: Web 应用。手动位置输入。GPX 下载。夜间/日间逻辑。
*   **v1.1**: “发送到设备”集成 (Garmin Connect API)。
*   **v1.2**: 社区验证 (用户对生成的绕圈进行点赞/点踩)。
